{"version":3,"sources":["angular-weibo-emotify.js"],"names":["angular","module","provider","this","setEmotionsURL","url","emotionsURL","$get","$window","$http","$q","weiboEmotifyFactory","_str","_text","replace","str","key","_id","emotions_list","prefix","id","type","indexOf","suffix","Error","ls","localStorage","JSON","parse","getItem","resolve","reject","get","success","data","Object","prototype","toString","call","setItem","stringify","error","err","then","directive","$timeout","weiboEmotify","restrict","link","scope","elem","attrs","emotify","html"],"mappings":";;;;;;;;AASAA,QAAQC,OAAO,oBACdC,SAAS,eAAgB,WAEtBC,KAAKC,eAAiB,SAAUC,GAC5BF,KAAKG,YAAcD,GAGvBF,KAAKI,MAAQ,UAAW,QAAS,KAAM,SAASC,EAASC,EAAOC,GAyC5D,QAASC,GAAoBC,GACzB,GAAKA,EAAL,CAEA,GAAIC,GAAQD,EACXE,QAAQ,0BAA2B,SAAUC,GAO1C,GAAIC,GAAMD,EAAID,QAAQ,UAAW,IAC7BG,EAAMC,EAAcF,EAExB,KAAKC,EAAK,MAAOF,EAWjB,IAAII,GAAS,4DACTC,EAASH,EAAIH,QAAQ,YAAa,KAAKA,QAAQ,IAAK,IACpDO,EAASJ,EAAIK,QAAQ,KAAO,EAAI,OAASL,EAAIK,QAAQ,KAAO,EAAI,SAAW,GAC3EC,EAASN,EAAIK,QAAQ,KAAO,EAAI,OAAS,MAE7C,OAAO,cAAgBP,EAAM,UAAYA,EAAM,UACrCI,EACAC,EACAC,EACAE,EACA,MAGd,OAAOV,IAAS,IA9EpB,IAAKV,KAAKG,YACN,KAAM,IAAIkB,OAAM,4BAGpB,IAAIC,GAAKjB,EAAQkB,aACbR,EAAgBO,GAAME,KAAKC,MAAMH,EAAGI,QAAQ,kBAC5CvB,EAAcH,KAAKG,WAEvB,OAAOI,GAAG,SAAUoB,EAASC,GACpBb,GAAyC,QAAxBA,EAAkB,GAqBpCY,IApBArB,EAAMuB,IAAI1B,GACT2B,QAAQ,SAAUC,GAEf,MAA6C,oBAAzCC,OAAOC,UAAUC,SAASC,KAAKJ,OAC/BH,GAAO,mCAGQ,QAAfG,EAAS,OACTH,GAAO,gCAIXN,GAAMA,EAAGc,QAAQ,gBAAiBZ,KAAKa,UAAUN,IACjDhB,EAAgBgB,MAChBJ,QAEHW,MAAM,SAAUC,GACbX,EAAOW,OAMlBC,KAAK,WACF,MAAOhC,KA1BJD,SA4BA,SAAUgC,GACb,KAAM,IAAIlB,OAAMkB,SA6C3BE,UAAU,gBAAiB,WAAY,eAAgB,SAAUC,EAAUC,GAExE,OACIC,SAAU,IACVC,KAAM,SAAUC,EAAOC,EAAMC,GACzBL,EACCH,KAAK,SAAUS,GACZP,EAAS,WACLK,EAAKG,KAAKD,EAAQF,EAAKG","file":"angular-weibo-emotify.min.js","sourcesContent":["/*!\n * angular-weibo-emotify - Angular directive and service to emotify weibo text\n * https://github.com/RoberMac/angular-weibo-emotify\n *\n * Copyright (c) 2015 RoberTu <robertu0717@gmail.com>\n * @license MIT\n * @version v0.3.0\n */\n\nangular.module('weibo-emotify', [])\n.provider('weiboEmotify', function (){\n\n    this.setEmotionsURL = function (url){\n        this.emotionsURL = url\n    }\n\n    this.$get = ['$window', '$http', '$q', function($window, $http, $q){\n        if (!this.emotionsURL) {\n            throw new Error('`emotionsURL` is required')\n        }\n\n        var ls = $window.localStorage;\n        var emotions_list = ls && JSON.parse(ls.getItem('weiboEmotions'));\n        var emotionsURL = this.emotionsURL;\n\n        return $q(function (resolve, reject){\n            if (!emotions_list || emotions_list['_v'] !== '2.0'){\n                $http.get(emotionsURL)\n                .success(function (data){\n\n                    if (Object.prototype.toString.call(data) !== '[object Object]') {\n                        reject('`emotions_list` is not a Object')\n                        return;\n                    }\n                    if (data['_v'] !== '2.0') {\n                        reject('`emotions_list` is not v2.0')\n                        return;\n                    }\n\n                    ls && ls.setItem('weiboEmotions', JSON.stringify(data))\n                    emotions_list = data\n                    resolve()\n                })\n                .error(function (err){\n                    reject(err)\n                })\n            } else {\n                resolve()\n            }\n        })\n        .then(function (){\n            return weiboEmotifyFactory\n        })\n        .catch(function (err){\n            throw new Error(err)\n        })\n\n        function weiboEmotifyFactory(_str){\n            if (!_str) return;\n\n            var _text = _str\n            .replace(/\\[[\\u4e00-\\u9fa5\\w]+\\]/g, function (str){\n                /**\n                 * Key Structure\n                 *\n                 * [key] -> key\n                 *\n                 */\n                var key = str.replace(/[\\[\\]]/g, '');\n                var _id = emotions_list[key];\n\n                if (!_id) return str;\n\n                /**\n                 * URL Structure\n                 *\n                 * 1) Prefix (Static): http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/\n                 * 2) ID\n                 * 3) Type: '+' -> '_thumb' | '-' -> '_org' | '@' -> ''\n                 * 4) Suffix: '?' -> '.png' | '.gif'\n                 *\n                 */\n                var prefix = 'http://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/';\n                var id     = _id.replace(/\\-|\\+|\\@/g, '/').replace('?', '');\n                var type   = _id.indexOf('-') > 0 ? '_org' : _id.indexOf('+') > 0 ? '_thumb' : '';\n                var suffix = _id.indexOf('?') > 0 ? '.png' : '.gif';\n\n                return '<img text=\"' + str + '\" alt=\"' + str + '\" src=\"'\n                        + prefix\n                        + id\n                        + type\n                        + suffix\n                        + '\">';\n            });\n\n            return _text || '';\n        }\n    }]\n})\n.directive('weiboEmotify', ['$timeout', 'weiboEmotify', function ($timeout, weiboEmotify){\n\n    return {\n        restrict: 'A',\n        link: function (scope, elem, attrs){\n            weiboEmotify\n            .then(function (emotify){\n                $timeout(function () {\n                    elem.html(emotify(elem.html()));\n                })\n            })\n        }\n    }\n}])"],"sourceRoot":"/source/"}